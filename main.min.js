var Jobj,Arrs=[],Dates=[],before_X=0,plus_count=4;function showDetail(a,t,e){document.getElementById(a).style.display="",document.getElementById(a).style.left=(window.innerWidth-t)/2+"px",document.getElementById(a).style.top=(window.innerHeight-e)/2+"px"}function MsgAlert(){var a=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0].split("#")[1];if(""!=a&&null!=a){a=parseInt(a);var t=Jobj.data[a-1],e="";switch(t.status){case 0:e="(사망)";break;case 2:e="(완치)"}document.getElementById("title_").innerText=t.num+"번 확진자 "+e;var r="",s="";switch(t.country){case"cn":s="중국";break;case"kr":s="한국"}r+="<h3 class='d'>"+t.from+" <span>"+t.age+(isNaN(t.age)?"?세":"세")+" "+s+" "+("w"==t.sex?"여성":"남성")+"</span></h3>",r+="<p>접촉자 "+(void 0!==t.contact?t.contact+"명":"확인중")+", "+(void 0!==Arrs[a+plus_count].children?Arrs[a+plus_count].children.length+"":"0")+"명에게 전파</p>",r+="<p>격리 병원 : "+t.hospital+"</p>",r+="<p>확진 날짜 : "+t.confirmDate+"</p>",r+=2==t.status?"<p>퇴원 날짜 : "+t.dischargeDate+"</p>":"",document.getElementById("info_").innerHTML=r,showDetail("alertMsg",324,204)}}Arrs.push(JSON.parse('{"text": {"cn": "2019-nCov","name":""},"HTMLclass":"title"}')),Arrs.push(JSON.parse('{"text": {"country":"중국","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"일본","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"태국","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"싱가포르","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],function(){var a=new XMLHttpRequest;a.open("GET","./data.json",!0),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){Jobj=JSON.parse(a.responseText),document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;var t=0,e=0,r=0,s=0,n=[],o=JSON.parse('{"kr":0,"cn":0,"default":0}'),d=JSON.parse('{"0":0,"1":0,"2":0}'),u=100,l=0,c=0;CheckDate();for(var i=0;i<Jobj.data.length;i++){switch(Arrs.push(JSON.parse("{}")),Arrs[Arrs.length-1].text=JSON.parse('{"name": "#'+Jobj.data[i].num+'"}'),Arrs[Arrs.length-1].image="./"+Jobj.data[i].sex+".png",Jobj.data[i].parent){case 0:switch(Jobj.data[i].from){case"일본 방문":Arrs[Arrs.length-1].parent=Arrs[2];break;case"태국 방문":Arrs[Arrs.length-1].parent=Arrs[3];break;case"싱가포르 방문":Arrs[Arrs.length-1].parent=Arrs[4];break;default:Arrs[Arrs.length-1].parent=Arrs[1]}break;default:Arrs[Arrs.length-1].parent=Arrs[Jobj.data[i].parent+plus_count]}switch(null==n[Jobj.data[i].hospital]&&(n.push({name:Jobj.data[i].hospital,cou:0,cou2:0,cou0:0}),n[Jobj.data[i].hospital]=n.length-1),1==Jobj.data[i].status?n[n[Jobj.data[i].hospital]].cou++:2==Jobj.data[i].status?n[n[Jobj.data[i].hospital]].cou2++:0==Jobj.data[i].status&&n[n[Jobj.data[i].hospital]].cou0++,Jobj.data[i].wuhan&&(r++,"우한 교민"==Jobj.data[i].from&&s++),Arrs[Arrs.length-1].HTMLclass="status_"+Jobj.data[i].status,d[Jobj.data[i].status]++,isNaN(Jobj.data[i].age)?c++:t+=parseInt(Jobj.data[i].age),u=u>Jobj.data[i].age?Jobj.data[i].age:u,l=l<Jobj.data[i].age?Jobj.data[i].age:l,"m"==Jobj.data[i].sex&&e++,Jobj.data[i].country){case"kr":o.kr++;break;case"cn":o.cn++;break;default:o.default++}}Arrs.push(JSON.parse('{"container": "#nCov","nodeAlign": "BOTTOM","connectors": {"type": "step"},"node": {"HTMLclass": "node1","collapsable": true}}')),new Treant(Arrs),before_X=window.innerWidth;var p=document.getElementsByClassName("node");for(i=0;i<p.length;i++)p[i].addEventListener("click",MsgAlert);var b="";n.sort(function(a,t){return parseInt(a.cou)>parseInt(t.cou)?-1:parseInt(a.cou)<parseInt(t.cou)?1:0}),b+="<p>총 확진자 수 : <b>"+Jobj.data.length+"명</b> (우한 방문자 "+r+"명)</p>",b+="<p>격리중 : <b>"+d[1]+"명</b>, 완치 : "+d[2]+"명, 사망자 : "+d[0]+"명</p>",b+="<p>유증상자 : 조사 중 <b>"+Jobj.info.Symptom_quarantine+"명</b>, 격리해제(음성) "+Jobj.info.Symptom_release+"명",b+="<p>평균 연령 : "+parseFloat((t/(Jobj.data.length-c)).toFixed(1))+"세 ("+u+"~"+l+"세)"+(c>0?" , "+c+"명 나이확인 안됨.":"")+"</p>";var h=e>Jobj.data.length-e;b+="<p>성비 : 남성 "+e+"명 : 여성 "+(Jobj.data.length-e)+"명 "+(h?"("+parseFloat((e/(Jobj.data.length-e)).toFixed(1))+" : 1)":"(1 : "+parseFloat(((Jobj.data.length-e)/e).toFixed(1))+")")+"</p>",b+="<p>국적 : 한국인 "+o.kr+"명, 중국인 "+o.cn+"명</p>",b+="<p>우한 교민 : <b>"+s+"명</b> 확진</p>",b+="<br><div class='stats_inner'><h4>격리 병원 통계</h4><ul class='sitelist'>";var g="";for(i=0;i<n.length;i++)"확인중"==n[i].name?g="<li>"+n[i].name+" : "+n[i].cou+"명</li>":0!=n[i].cou&&(b+="<li>"+n[i].name+" : "+n[i].cou+"명</li>");b+=g+"</ul></div>",b+="<div class='stats_inner'><h4>완치 병원 통계</h4><ul class='sitelist'>",n.sort(function(a,t){return parseInt(a.cou2)>parseInt(t.cou2)?-1:parseInt(a.cou2)<parseInt(t.cou2)?1:0});for(i=0;i<n.length;i++)0!=n[i].cou2&&(b+="<li>"+n[i].name+" : "+n[i].cou2+"명 퇴원</li>");b+="</ul></div>",document.getElementById("stats").innerHTML=b,drawGR()}else alert("데이터 로딩에 실패하였습니다.")},a.send()}(),window.addEventListener("resize",function(){if(before_X!=window.innerWidth){Treant(Arrs);for(var a=document.getElementsByClassName("node"),t=0;t<a.length;t++)a[t].addEventListener("click",MsgAlert)}});var gr_day,gr_age,confirmData=[],dischargeData=[];function drawGR(){gr_day&&gr_day.destroy(),gr_age&&gr_age.destroy(),gr_day=new Chart(document.getElementById("Day_stats").getContext("2d"),{type:"line",data:{labels:Dates,datasets:[{label:"총 확진자 수",data:confirmData,backgroundColor:"rgba(255, 159, 64, 0)",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,lineTension:0},{label:"완치자 수",data:dischargeData,borderColor:"rgba(75, 192, 192, 0.8)",backgroundColor:"rgba(75, 192, 192, 0)",borderWidth:2,lineTension:0}]}});var a=CheckAge();gr_age=new Chart(document.getElementById("Age_stats").getContext("2d"),{type:"bar",data:{labels:["0-9세","10-19세","20-29세","30-39세","40-49세","50-59세","60-69세","70-79세","80세 이상"],datasets:[{label:"총 확진자 수",data:a[0],backgroundColor:"rgba(255, 99, 132,0.8)",borderColor:"rgba(255, 99, 132, 0)",borderWidth:2,lineTension:0},{label:"완치자 수",data:a[1],borderColor:"rgba(75, 192, 192, 0)",backgroundColor:"rgba(75, 192, 192, 0.8)",borderWidth:2,lineTension:0}]}})}function CheckDate(){var a=Jobj.data.length-1,t=new Date(Jobj.data[0].confirmDate).getTime(),e=new Date(Jobj.data[a].confirmDate).getTime(),r=[],s=0,n=0;Dates=[];for(var o=[],d=0;d<Jobj.data.length;d++)o[o.length-1]!=Jobj.data[d].confirmDate&&(o.push(Jobj.data[d].confirmDate),r.push({name:Jobj.data[d].confirmDate,cou1:0,cou2:0,cou0:0,total1:0}),r[Jobj.data[d].confirmDate]=r.length-1),r[r[Jobj.data[d].confirmDate]].cou1++,s++,r[r[Jobj.data[d].confirmDate]].total1=s;for(d=0;d<Jobj.data.length;d++)2==Jobj.data[d].status?r[r[Jobj.data[d].dischargeDate]].cou2++:0==Jobj.data[d].status&&r[r[Jobj.data[d].confirmDate]].cou0++;var u=0,l=addDays(t,d=0);for(d++,Dates.push(formatDate(l)),n+=parseInt(r[r[o[0]]].cou2),confirmData.push(r[r[o[0]]].total1),dischargeData.push(n);;){l=addDays(t,d);if(d++,!(l>=t&&l<=e))break;Dates.push(formatDate(l)),new Date(o[u]).getTime()<=l.getTime()&&u<o.length&&u++,n+=parseInt(r[r[o[u-1]]].cou2),confirmData.push(r[r[o[u-1]]].total1),dischargeData.push(n)}}function CheckAge(){for(var a=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),t=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),e=0;e<Jobj.data.length;e++)switch(parseInt(Jobj.data[e].age/10)){case 0:a.a0++,2==Jobj.data[e].status&&t.a0++;break;case 1:a.a1++,2==Jobj.data[e].status&&t.a1++;break;case 2:a.a2++,2==Jobj.data[e].status&&t.a2++;break;case 3:a.a3++,2==Jobj.data[e].status&&t.a3++;break;case 4:a.a4++,2==Jobj.data[e].status&&t.a4++;break;case 5:a.a5++,2==Jobj.data[e].status&&t.a5++;break;case 6:a.a6++,2==Jobj.data[e].status&&t.a6++;break;case 7:a.a7++,2==Jobj.data[e].status&&t.a7++;break;default:a.a8++,2==Jobj.data[e].status&&t.a8++}var r=[],s=[],n=[];return r.push(a.a0),r.push(a.a1),r.push(a.a2),r.push(a.a3),r.push(a.a4),r.push(a.a5),r.push(a.a6),r.push(a.a7),r.push(a.a8),n.push(r),s.push(t.a0),s.push(t.a1),s.push(t.a2),s.push(t.a3),s.push(t.a4),s.push(t.a5),s.push(t.a6),s.push(t.a7),s.push(t.a8),n.push(s),n}function formatDate(a){var t=new Date(a),e=""+(t.getMonth()+1),r=""+t.getDate(),s=t.getFullYear();return e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),[s,e,r].join("-")}function addDays(a,t){var e=new Date(a);return e.setDate(e.getDate()+t),e}function listdata(a,t){for(var e=[],r=0;r<Dates.length;r++)t(r)&&e.push(a(r));return e}function listarr(a,t){for(var e=[],r=a.length,s=0;s<r;s++)t(s)&&e.push(a[s]);return e}
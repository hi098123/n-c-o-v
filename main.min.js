var Jobj,gr_day,Arrs=[],Dates=[],before_X=0,plus_count=4;function showDetail(t,a,e){document.getElementById(t).style.display="",document.getElementById(t).style.left=(window.innerWidth-a)/2+"px",document.getElementById(t).style.top=(window.innerHeight-e)/2+"px"}function MsgAlert(){var t=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0].split("#")[1];if(""!=t&&null!=t){t=parseInt(t);var a=Jobj.data[t-1],e="";switch(a.status){case 0:e="(사망)";break;case 2:e="(완치)"}document.getElementById("title_").innerText=a.num+"번 확진자 "+e;var r="",n="";switch(a.country){case"cn":n="중국";break;case"kr":n="한국"}r+="<h3 class='d'>"+a.from+" <span>"+a.age+(isNaN(a.age)?"?세":"세")+" "+n+" "+("w"==a.sex?"여성":"남성")+"</span></h3>",r+="<p>접촉자 "+(void 0!==a.contact?a.contact+"명":"확인중")+", "+(void 0!==Arrs[t+plus_count].children?Arrs[t+plus_count].children.length+"":"0")+"명에게 전파</p>",r+="<p>격리 병원 : "+a.hospital+"</p>",r+="<p>확진 날짜 : "+a.confirmDate+"</p>",r+=2==a.status?"<p>퇴원 날짜 : "+a.dischargeDate+"</p>":"",document.getElementById("info_").innerHTML=r,showDetail("alertMsg",324,204)}}Arrs.push(JSON.parse('{"text": {"cn": "2019-nCov","name":""},"HTMLclass":"title"}')),Arrs.push(JSON.parse('{"text": {"country":"중국","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"일본","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"태국","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"싱가포르","name":""}}')),Arrs[Arrs.length-1].parent=Arrs[0],function(){var t=new XMLHttpRequest;t.open("GET","./data.json",!0),t.onreadystatechange=function(){if(4==t.readyState)if(200==t.status){Jobj=JSON.parse(t.responseText),document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;var a=0,e=0,r=0,n=0,s=[],o=JSON.parse('{"kr":0,"cn":0,"default":0}'),d=JSON.parse('{"0":0,"1":0,"2":0}'),l=100,i=0,c=0;CheckDate();for(var u=0;u<Jobj.data.length;u++){switch(Arrs.push(JSON.parse("{}")),Arrs[Arrs.length-1].text=JSON.parse('{"name": "#'+Jobj.data[u].num+'"}'),Arrs[Arrs.length-1].image="./"+Jobj.data[u].sex+".png",Jobj.data[u].parent){case 0:switch(Jobj.data[u].from){case"일본 방문":Arrs[Arrs.length-1].parent=Arrs[2];break;case"태국 방문":Arrs[Arrs.length-1].parent=Arrs[3];break;case"싱가포르 방문":Arrs[Arrs.length-1].parent=Arrs[4];break;default:Arrs[Arrs.length-1].parent=Arrs[1]}break;default:Arrs[Arrs.length-1].parent=Arrs[Jobj.data[u].parent+plus_count]}switch(null==s[Jobj.data[u].hospital]&&(s.push({name:Jobj.data[u].hospital,cou:0,cou2:0,cou0:0}),s[Jobj.data[u].hospital]=s.length-1),1==Jobj.data[u].status?s[s[Jobj.data[u].hospital]].cou++:2==Jobj.data[u].status?s[s[Jobj.data[u].hospital]].cou2++:0==Jobj.data[u].status&&s[s[Jobj.data[u].hospital]].cou0++,Jobj.data[u].wuhan&&(r++,"우한 교민"==Jobj.data[u].from&&n++),Arrs[Arrs.length-1].HTMLclass="status_"+Jobj.data[u].status,d[Jobj.data[u].status]++,isNaN(Jobj.data[u].age)?c++:a+=parseInt(Jobj.data[u].age),l=l>Jobj.data[u].age?Jobj.data[u].age:l,i=i<Jobj.data[u].age?Jobj.data[u].age:i,"m"==Jobj.data[u].sex&&e++,Jobj.data[u].country){case"kr":o.kr++;break;case"cn":o.cn++;break;default:o.default++}}Arrs.push(JSON.parse('{"container": "#nCov","nodeAlign": "BOTTOM","connectors": {"type": "step"},"node": {"HTMLclass": "node1","collapsable": true}}')),new Treant(Arrs),before_X=window.innerWidth;var p=document.getElementsByClassName("node");for(u=0;u<p.length;u++)p[u].addEventListener("click",MsgAlert);var b="";s.sort(function(t,a){return parseInt(t.cou)>parseInt(a.cou)?-1:parseInt(t.cou)<parseInt(a.cou)?1:0}),b+="<p>총 확진자 수 : <b>"+Jobj.data.length+"명</b> (우한 방문자 "+r+"명)</p>",b+="<p>격리중 : <b>"+d[1]+"명</b>, 완치 : "+d[2]+"명, 사망자 : "+d[0]+"명</p>",b+="<p>유증상자 : 조사 중 <b>"+Jobj.info.Symptom_quarantine+"명</b>, 격리해제(음성) "+Jobj.info.Symptom_release+"명",b+="<p>평균 연령 : "+parseFloat((a/(Jobj.data.length-c)).toFixed(1))+"세 ("+l+"~"+i+"세)"+(c>0?" , "+c+"명 나이확인 안됨.":"")+"</p>";var h=e>Jobj.data.length-e;b+="<p>성비 : 남성 "+e+"명 : 여성 "+(Jobj.data.length-e)+"명 "+(h?"("+parseFloat((e/(Jobj.data.length-e)).toFixed(1))+" : 1)":"(1 : "+parseFloat(((Jobj.data.length-e)/e).toFixed(1))+")")+"</p>",b+="<p>국적 : 한국인 "+o.kr+"명, 중국인 "+o.cn+"명</p>",b+="<p>우한 교민 : <b>"+n+"명</b> 확진</p>",b+="<br><div class='stats_inner'><h4>격리 병원 통계</h4><ul class='sitelist'>";var g="";for(u=0;u<s.length;u++)"확인중"==s[u].name?g="<li>"+s[u].name+" : "+s[u].cou+"명</li>":0!=s[u].cou&&(b+="<li>"+s[u].name+" : "+s[u].cou+"명</li>");b+=g+"</ul></div>",b+="<div class='stats_inner'><h4>완치 병원 통계</h4><ul class='sitelist'>",s.sort(function(t,a){return parseInt(t.cou2)>parseInt(a.cou2)?-1:parseInt(t.cou2)<parseInt(a.cou2)?1:0});for(u=0;u<s.length;u++)0!=s[u].cou2&&(b+="<li>"+s[u].name+" : "+s[u].cou2+"명 퇴원</li>");b+="</ul></div>",document.getElementById("stats").innerHTML=b,drawGR()}else alert("데이터 로딩에 실패하였습니다.")},t.send()}(),window.addEventListener("resize",function(){if(before_X!=window.innerWidth){Treant(Arrs);for(var t=document.getElementsByClassName("node"),a=0;a<t.length;a++)t[a].addEventListener("click",MsgAlert)}});var confirmData=[],dischargeData=[];function drawGR(){gr_day&&gr_day.destroy(),gr_day=new Chart(document.getElementById("Day_stats").getContext("2d"),{type:"line",data:{labels:Dates,datasets:[{label:"확진자 수",data:confirmData,backgroundColor:"rgba(255, 159, 64, 0)",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,lineTension:0},{label:"완치자 수",data:dischargeData,borderColor:"rgba(75, 192, 192, 0.8)",backgroundColor:"rgba(75, 192, 192, 0)",borderWidth:2,lineTension:0}]}})}function CheckDate(){var t=Jobj.data.length-1,a=new Date(Jobj.data[0].confirmDate).getTime(),e=new Date(Jobj.data[t].confirmDate).getTime(),r=[],n=0,s=0;Dates=[];for(var o=[],d=0;d<Jobj.data.length;d++)o[o.length-1]!=Jobj.data[d].confirmDate&&(o.push(Jobj.data[d].confirmDate),r.push({name:Jobj.data[d].confirmDate,cou1:0,cou2:0,cou0:0,total1:0}),r[Jobj.data[d].confirmDate]=r.length-1),r[r[Jobj.data[d].confirmDate]].cou1++,n++,r[r[Jobj.data[d].confirmDate]].total1=n;for(d=0;d<Jobj.data.length;d++)2==Jobj.data[d].status?r[r[Jobj.data[d].dischargeDate]].cou2++:0==Jobj.data[d].status&&r[r[Jobj.data[d].confirmDate]].cou0++;d=0;for(var l=0;;){var i=addDays(a,d);if(d++,!(i>=a&&i<=e))break;Dates.push(formatDate(i)),new Date(o[l]).getTime()<i.getTime()&&l++,s+=parseInt(r[r[o[l]]].cou2),confirmData.push(r[r[o[l]]].total1),dischargeData.push(s)}}function formatDate(t){var a=new Date(t),e=""+(a.getMonth()+1),r=""+a.getDate(),n=a.getFullYear();return e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),[n,e,r].join("-")}function addDays(t,a){var e=new Date(t);return e.setDate(e.getDate()+a),e}function listdata(t,a){for(var e=[],r=0;r<Dates.length;r++)a(r)&&e.push(t(r));return e}function listarr(t,a){for(var e=[],r=t.length,n=0;n<r;n++)a(n)&&e.push(t[n]);return e}
<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width">
    <title>2019-nCov 한국 감염표</title>
    <link rel="stylesheet" href="Treant.css">
    <link rel="stylesheet" href="cc.css">
    <meta name="description" content="신종 코로나(우한 폐렴) 감염자들의 관계도를 그린 페이지입니다.">
    <meta property="og:url" content="https://ncov-korea.cf/" >
    <meta property="og:site_name" content="2019-nCov 한국 감염표" >
    <meta property="og:title" content="2019-nCov 한국 감염표" >
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-136150577-3"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-136150577-3');
    </script>
    <script data-ad-client="ca-pub-2722856117249943" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <style>
        a{text-decoration: none;color: #3f51b5;}
        .sitelist{line-height: 2;padding: 0}
        .sitelist li{list-style: inside;}
    </style>
</head>
<body>
    <h1 style="text-align: center;padding: 20px 0;margin: 0 0 20px;background-color: #222;color: #fff;"><span style="display: inline-block;">신종 코로나 바이러스</span> <span style="display: inline-block;">확진자 현황</span></h1>
    <div class="top"></div>
    <div class="chart" id="nCov"> 표 생성중. . . 계속 생성중이라면, 새로고침 해주세요 </div>
    <div class="content">
        <h3 id="update">최근 업데이트 : ####-##-## ##시##분</h3>
        <br>
        <h3>소개</h3>
        <p>신종 코로나 바이러스 감염증의 확진자 현황 관계도를 그린 페이지입니다.</p>
        <p>데이터 파일을 이용하여 쉽게 관계도가 그려지도록 만들어졌으며,</p>
        <p>누구나 쉽게 데이터 파일을 수정가능하도록 아래와 같이 형식을 소개 해드립니다.</p>
        <br>
        <h3>자료 출처</h3>
        <p>질병관리본부 홈페이지와 뉴스 기사</p>
        <p>* 출처마다 나이가 ± 1 정도 차이 날수도 있음</p>
        <br>
        <h3>사이트</h3>
        <ul class="sitelist">
            <li><a href="http://www.cdc.go.kr/contents.es?mid=a21111050500">질병관리본부 홈페이지</a></li>
            <li><a href="./search.html">선별진료소 검색하기</li>
            <li><a href="http://www.mohw.go.kr/react/popup_200128.html">선별진료소 현황</a></li>
        </ul>
        <br>
        <h3>데이터 파일</h3>
        <p>다운로드 : <a href="./data.json">보기 (.json)</a></p>
        <h4>데이터 형식 (버전 0.0.1)</h4>
        <p>개발자들이 주로 쓰는 json 형식, 어렵지않다. 표를 글자로 표현한다고 생각하면 쉽다.</p>
        <ul style="background-color: #F5F5F5;padding: 20px;border-radius: 20px;">
            {
                <li>"num":1,<span class="notjson"> => 첫번째 감염자</span></li>
                <li>"sex":"w",<span class="notjson"> => 성별 : 여성, 남성은 m {"m","w"}</span></li>
                <li>"age":35,<span class="notjson"> => 나이 : 35세</span></li>
                <li>"parent":0,<span class="notjson"> => 모 감염자 번호 (기본값은 0)</span></li>
                <li>"country":"cn",<span class="notjson"> => cn: 중국, kr: 한국</span></li>
                <li>"contact":45,<span class="notjson"> => 접촉자 수</span></li>
                <li>"hospital":"인천의료원",<span class="notjson"> => 격리 병원</span></li>
                <li>"from":"우한 방문",<span class="notjson"> => 방문 지역 {"국내 감염","?? 방문"}</span></li>
                <li>"confirmDate":"2020-01-20"<span class="notjson"> => 확진 날짜 {yyyy-mm-dd}</span></li>
            }
        </ul>
        <br>
        <h3>제보</h3>
        <p>제보 페이지는 며칠이내 생성예정</p>
        <br>
        <h3>사용한 오픈소스</h3>
        <p>treant-js (MIT) https://fperucic.github.io/treant-js</p>
        <p>표를 그리기 위한 오픈소스로 기능 제작을 위해 일부 변형을 하였음</p>
    </div>
    <script src="raphael.js"></script>
    <script src="Treant.min.js"></script>
    <script>
        var Arrs=[];
        var Jobj;
        var before_X=0;
        Arrs.push(JSON.parse('{"text": {"cn": "2019-nCov","name":""},"HTMLclass":"title"}'));
        (function(){
            var xhr =new XMLHttpRequest;
            xhr.open("GET" , './data.json' , true);
            xhr.onreadystatechange = function() {
                if(xhr.readyState == 4){
                    if(xhr.status == 200){
                        Jobj=JSON.parse(xhr.responseText);
                        document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;
                        for (var i = 0; i < Jobj.data.length; i++) {
                            Arrs.push(JSON.parse('{}'));
                            Arrs[Arrs.length-1].text=JSON.parse('{"name": "'+Jobj.data[i].num+' ('+Jobj.data[i].age+'세)"}');
                            //,"date":"'+Jobj.data[i].confirmDate+'"
                            Arrs[Arrs.length-1].image="./"+Jobj.data[i].sex+".png";
                            Arrs[Arrs.length-1].parent=Arrs[Jobj.data[i].parent];
                            var bool_wuhan=(Jobj.data[i].from=="우한 방문"?true:false);
                            Arrs[Arrs.length-1].HTMLclass="wuhan_"+bool_wuhan;
                            /*if(i==8){
                                Arrs[Arrs.length-1].childrenDropLevel=2;
                            }*/
                        }
                        Arrs.push(JSON.parse('{"container": "#nCov","nodeAlign": "BOTTOM","connectors": {"type": "step"},"node": {"HTMLclass": "node1"}}'));
                        new Treant( Arrs );
                        before_X=window.innerWidth;

                        var nodes=document.getElementsByClassName("node");
                        for (var i = 0; i < nodes.length; i++) {
                            nodes[i].addEventListener('click', MsgAlert);
                        }
                    }else{
                        alert("데이터 로딩에 실패하였습니다.")
                    }
                }
            }
            xhr.send();
        })();
        window.addEventListener('resize',function (){
            if(before_X!=window.innerWidth){
                Treant( Arrs );
                var nodes=document.getElementsByClassName("node");
                for (var i = 0; i < nodes.length; i++) {
                    nodes[i].addEventListener('click', MsgAlert);
                }
            }
        })
        function showDetail(id_,wid_,hei_){
            document.getElementById(id_).style.display='';
            document.getElementById(id_).style.left=(window.innerWidth-wid_)/2+"px";
            document.getElementById(id_).style.top=(window.innerHeight-hei_)/2+"px";
        }
        function MsgAlert(){
            var num_=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0];
            if(num_==""){return;}
            var info=Jobj.data[num_-1];
            document.getElementById('title_').innerText=info.num+"번 확진자";
            var html='';
            var country='';
            switch(info.country){
                case "cn":
                    country="중국";
                    break;
                case "kr":
                    country="한국";
                    break;
            }
            html+="<h3 class='d'>"+info.from+" <span>"+info.age+(isNaN(info.age)?"?세":"세")+" "+country+" "+(info.sex=="w"?"여성":"남성")+"</span></h3>";
            html+="<p>접촉자 "+(typeof(info.contact)!="undefined"?info.contact+"명":"확인중")+", "+(typeof(Arrs[num_].children)!="undefined"?Arrs[num_].children.length+"":"0")+"명에게 전파</p>";
            html+="<p>격리 병원 : "+info.hospital+"</p>";
            html+="<p>확진 날짜 : "+info.confirmDate+"</p>";
            document.getElementById('info_').innerHTML=html;
            showDetail("alertMsg",324,204);
        }
    </script>
<div id="alertMsg" style="display: none;">
    <span class="xbtn" title="닫기" onclick="document.getElementById('alertMsg').style.display='none';">X</span>
    <h2 id="title_"></h2>
    <div id="info_"></div>
</div>
</body>
</html>
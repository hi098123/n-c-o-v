var Jobj,Arrs=[],Dates=[],before_X=0,plus_count=5;function showDetail(a,t,e){document.getElementById(a).style.display="",document.getElementById(a).style.left=(window.innerWidth-t)/2+"px",document.getElementById(a).style.top=(window.innerHeight-e)/2+"px"}function MsgAlert(){var a=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0].split("#")[1];if(""!=a&&null!=a){a=parseInt(a);var t=Jobj.data[a-1],e="";switch(t.status){case 0:e="(사망)";break;case 2:e="(완치)"}document.getElementById("title_").innerText=t.num+"번 확진자 "+e;var r="",s="";switch(t.country){case"cn":s="중국";break;case"kr":s="한국"}var n=0;switch(a){case 27:n=1}r+="<h3 class='d'>"+t.from+" <span>"+t.age+(isNaN(t.age)?"?세":"세")+" "+s+" "+("w"==t.sex?"여성":"남성")+"</span></h3>",r+="<p>접촉자 "+(void 0!==t.contact?t.contact+"명":"확인중")+", "+(0==n?"":"<i title='표의 표시와는 달리 확진자와 같은 장소 여행자는 포함 안 함'> * </i>")+(void 0!==Arrs[a+plus_count].children?Arrs[a+plus_count].children.length-n:"0")+"명에게 전파</p>",r+="<p>격리 병원 : "+t.hospital+"</p>",r+="<p>확진 날짜 : "+t.confirmDate+"</p>",r+=2==t.status?"<p>격리 해제 : "+t.dischargeDate+"</p>":"",document.getElementById("info_").innerHTML=r,showDetail("alertMsg",324,204)}}Arrs.push(JSON.parse('{"text": {"cn": "COVID-19","name":""},"HTMLclass":"title"}')),Arrs.push(JSON.parse('{"text": {"country":"중국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"일본","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"태국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"싱가포르","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"대한민국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],function(){var a=new XMLHttpRequest;a.open("GET","./data.json",!0),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){Jobj=JSON.parse(a.responseText),document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;var t=0,e=0,r=0,s=0,n=0,o=[],u=JSON.parse('{"kr":0,"cn":0,"default":0}'),c=JSON.parse('{"0":0,"1":0,"2":0}'),d=100,l=0,i=1e4,p=0,b=0,h=0,g=0,J=[],f=Jobj.info.update.split(" ")[0],m=formatDate(addDays(Jobj.info.update.split(" ")[0],-1));CheckDate();for(var A=0;A<Jobj.data.length;A++){switch(Arrs.push(JSON.parse("{}")),Arrs[Arrs.length-1].text=JSON.parse('{"name": "#'+Jobj.data[A].num+'"}'),Arrs[Arrs.length-1].image="./"+Jobj.data[A].sex+".png",Jobj.data[A].parent){case 0:switch(Jobj.data[A].from){case"일본 방문":Arrs[Arrs.length-1].parent=Arrs[2];break;case"태국 방문":Arrs[Arrs.length-1].parent=Arrs[3];break;case"싱가포르 방문":Arrs[Arrs.length-1].parent=Arrs[4];break;case"국내 감염":case"국내 감염?":Arrs[Arrs.length-1].parent=Arrs[5];break;default:Arrs[Arrs.length-1].parent=Arrs[1]}break;default:Arrs[Arrs.length-1].parent=Arrs[Jobj.data[A].parent+plus_count]}if(null==o[Jobj.data[A].hospital]&&(o.push({name:Jobj.data[A].hospital,cou:0,cou2:0,cou0:0}),o[Jobj.data[A].hospital]=o.length-1),1==Jobj.data[A].status)o[o[Jobj.data[A].hospital]].cou++;else if(2==Jobj.data[A].status){o[o[Jobj.data[A].hospital]].cou2++;var j=(new Date(Jobj.data[A].dischargeDate).getTime()-new Date(Jobj.data[A].confirmDate).getTime())/864e5;J.push(j),i=i>j?j:i,p=p<j?j:p,h++,b+=j}else 0==Jobj.data[A].status&&o[o[Jobj.data[A].hospital]].cou0++;switch(Jobj.data[A].wuhan&&(s++,"우한 교민"==Jobj.data[A].from&&n++),Arrs[Arrs.length-1].HTMLclass="status_"+Jobj.data[A].status,Jobj.data[A].confirmDate){case f:case m:Arrs[Arrs.length-1].HTMLclass+=" today_new"}switch(c[Jobj.data[A].status]++,isNaN(Jobj.data[A].age)?g++:t+=parseInt(Jobj.data[A].age),d=d>Jobj.data[A].age?Jobj.data[A].age:d,l=l<Jobj.data[A].age?Jobj.data[A].age:l,Jobj.data[A].sex){case"m":e++;break;case"w":r++;break;default:0}switch(Jobj.data[A].country){case"kr":u.kr++;break;case"cn":u.cn++;break;default:u.default++}}Arrs[26+plus_count].parent=Arrs[27+plus_count],Arrs[25+plus_count].parent=Arrs[27+plus_count],Arrs[31+plus_count].childrenDropLevel=1,Arrs[15+plus_count].connectors={style:{stroke:"#b71c1c","arrow-end":"block-wide-long"}},Arrs.push(JSON.parse('{"container": "#nCov","nodeAlign": "BOTTOM","connectors": {"type": "step","style": {"stroke-width": 2,"stroke": "#666"}},"node": {"HTMLclass": "node1","collapsable": true}}')),new Treant(Arrs),before_X=window.innerWidth;var D=document.getElementsByClassName("node");for(A=0;A<D.length;A++)D[A].addEventListener("click",MsgAlert);var y="";o.sort(function(a,t){return parseInt(a.cou)>parseInt(t.cou)?-1:parseInt(a.cou)<parseInt(t.cou)?1:0}),y+="<p>총 확진자 수 : <b>"+Jobj.data.length+"명</b> (우한 방문자 "+s+"명)</p>",y+="<p>격리중 : <b>"+c[1]+"명</b>, 완치 : <b>"+c[2]+"명</b>, 사망자 : "+c[0]+"명</p>",y+="<p>유증상자 : 조사 중 <b>"+Jobj.info.Symptom_quarantine+"명</b>, 격리해제(음성) "+Jobj.info.Symptom_release+"명",y+="<p>평균 연령 : <b>"+parseFloat((t/(Jobj.data.length-g)).toFixed(1))+"세</b> ("+d+"~"+l+"세)"+(g>0?" , "+g+"명 나이확인 안됨.":"")+"</p>",y+="<p>성비 : 남성 "+e+"명 : 여성 "+r+"명 "+(e>r?"("+parseFloat((e/r).toFixed(1))+" : 1)":"(1 : "+parseFloat((r/e).toFixed(1))+")")+"</p>",y+="<p>국적 : 한국인 "+u.kr+"명, 중국인 "+u.cn+"명</p>",y+="<p>우한 교민 : <b>"+n+"명</b> 확진</p>",y+="<p>회복 시간 : <b>평균 "+parseFloat(parseFloat(b/h).toFixed(1))+"일</b> ("+i+"~"+p+"일)</p>",y+="<br><div class='stats_inner'><h4>격리 병원 통계 (총 "+c[1]+"명)</h4><ul class='sitelist'>";var w="";for(A=0;A<o.length;A++)"확인중"==o[A].name?w="<li>"+o[A].name+" : "+o[A].cou+"명</li>":0!=o[A].cou&&(y+="<li>"+o[A].name+" : "+o[A].cou+"명</li>");y+=w+"</ul></div>",y+="<div class='stats_inner'><h4>완치 병원 통계 (총 "+c[2]+"명)</h4><ul class='sitelist'>",o.sort(function(a,t){return parseInt(a.cou2)>parseInt(t.cou2)?-1:parseInt(a.cou2)<parseInt(t.cou2)?1:0});for(A=0;A<o.length;A++)0!=o[A].cou2&&(y+="<li>"+o[A].name+" : "+o[A].cou2+"명</li>");y+="</ul></div>",document.getElementById("stats").innerHTML=y,drawGR()}else alert("데이터 로딩에 실패하였습니다.")},a.send()}(),window.addEventListener("resize",function(){if(before_X!=window.innerWidth){before_X=window.innerWidth,Treant(Arrs),Arrs[31+plus_count].childrenDropLevel=1;for(var a=document.getElementsByClassName("node"),t=0;t<a.length;t++)a[t].addEventListener("click",MsgAlert)}});var gr_day,gr_age,confirmData=[],dischargeData=[];function drawGR(){gr_day&&gr_day.destroy(),gr_age&&gr_age.destroy(),gr_day=new Chart(document.getElementById("Day_stats").getContext("2d"),{type:"line",data:{labels:Dates,datasets:[{label:"총 확진자 수",data:confirmData,backgroundColor:"rgba(255, 159, 64, 0)",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,lineTension:0},{label:"완치자 수",data:dischargeData,borderColor:"rgba(75, 192, 192, 0.8)",backgroundColor:"rgba(75, 192, 192, 0)",borderWidth:2,lineTension:0}]}});var a=CheckAge();gr_age=new Chart(document.getElementById("Age_stats").getContext("2d"),{type:"bar",data:{labels:["0-9세","10-19세","20-29세","30-39세","40-49세","50-59세","60-69세","70-79세","80세 이상"],datasets:[{label:"총 확진자 수",data:a[0],backgroundColor:"rgba(255, 99, 132,0.8)",borderColor:"rgba(255, 99, 132, 0)",borderWidth:2,lineTension:0},{label:"완치자 수",data:a[1],borderColor:"rgba(75, 192, 192, 0)",backgroundColor:"rgba(75, 192, 192, 0.8)",borderWidth:2,lineTension:0}]}})}function CheckDate(){Jobj.data.length;var a=new Date(Jobj.data[0].confirmDate).getTime(),t=new Date(Jobj.info.update.split(" ")[0]).getTime(),e=[],r=0,s=0;Dates=[];for(var n=[],o=0;;){var u=addDays(a,o);if(o++,!(u>=a&&u<=t))break;var c=formatDate(u);Dates.push(c),null==e[c]&&(e.push({name:c,cou1:0,cou2:0,cou0:0}),e[c]=e.length-1)}for(o=0;o<Jobj.data.length;o++)n[n.length-1]!=Jobj.data[o].confirmDate&&n.push(Jobj.data[o].confirmDate),e[e[Jobj.data[o].confirmDate]].cou1++,2==Jobj.data[o].status?e[e[Jobj.data[o].dischargeDate]].cou2++:0==Jobj.data[o].status&&e[e[Jobj.data[o].confirmDate]].cou0++;r=0,s+=parseInt(e[e[n[0]]].cou2),r+=e[e[n[0]]].cou1,confirmData.push(e[e[n[0]]].cou1),dischargeData.push(s);for(o=1;o<Dates.length;o++)s+=parseInt(e[e[Dates[o]]].cou2),r+=e[e[Dates[o]]].cou1,confirmData.push(r),dischargeData.push(s)}function CheckAge(){for(var a=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),t=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),e=0;e<Jobj.data.length;e++)if(!isNaN(Jobj.data[e].age))switch(parseInt(Jobj.data[e].age/10)){case 0:a.a0++,2==Jobj.data[e].status&&t.a0++;break;case 1:a.a1++,2==Jobj.data[e].status&&t.a1++;break;case 2:a.a2++,2==Jobj.data[e].status&&t.a2++;break;case 3:a.a3++,2==Jobj.data[e].status&&t.a3++;break;case 4:a.a4++,2==Jobj.data[e].status&&t.a4++;break;case 5:a.a5++,2==Jobj.data[e].status&&t.a5++;break;case 6:a.a6++,2==Jobj.data[e].status&&t.a6++;break;case 7:a.a7++,2==Jobj.data[e].status&&t.a7++;break;default:a.a8++,2==Jobj.data[e].status&&t.a8++}var r=[],s=[],n=[];return r.push(a.a0),r.push(a.a1),r.push(a.a2),r.push(a.a3),r.push(a.a4),r.push(a.a5),r.push(a.a6),r.push(a.a7),r.push(a.a8),n.push(r),s.push(t.a0),s.push(t.a1),s.push(t.a2),s.push(t.a3),s.push(t.a4),s.push(t.a5),s.push(t.a6),s.push(t.a7),s.push(t.a8),n.push(s),n}function formatDate(a){var t=new Date(a),e=""+(t.getMonth()+1),r=""+t.getDate(),s=t.getFullYear();return e.length<2&&(e="0"+e),r.length<2&&(r="0"+r),[s,e,r].join("-")}function addDays(a,t){var e=new Date(a);return e.setDate(e.getDate()+t),e}function listdata(a,t){for(var e=[],r=0;r<Dates.length;r++)t(r)&&e.push(a(r));return e}function listarr(a,t){for(var e=[],r=a.length,s=0;s<r;s++)t(s)&&e.push(a[s]);return e}
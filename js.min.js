var Jobj,Arrs=[],Dates=[],before_X=window.innerWidth,plus_count=15;function showDetail(a,e,t){document.getElementById(a).style.display="",document.getElementById(a).style.left=(window.innerWidth-e)/2+"px",document.getElementById(a).style.top=(window.innerHeight-t)/2+"px"}function MsgAlert(){var a=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0].split("#")[1];if(""!=a&&null!=a){a=parseInt(a);var e=Jobj.data[a-1],t="";switch(e.status){case 0:t="(사망)";break;case 2:t="(완치)"}document.getElementById("title_").innerText=e.num+"번 확진자 "+t;var r="",s="";switch(e.country){case"cn":s="중국";break;case"kr":s="한국"}var n=0;switch(a){case 27:n=1}r+="<h3 class='d'>"+e.from+" <span>"+e.age+(isNaN(e.age)?"?세":"세")+" "+s+" "+("w"==e.sex?"여성":"m"==e.sex?"남성":"")+"</span></h3>",r+="<p>접촉자 "+(void 0!==e.contact?e.contact+"명":"확인중")+", "+(0==n?"":"<i title='표의 표시와는 달리 확진자와 같은 장소 여행자는 포함 안 함'> * </i>")+(void 0!==Arrs[a+plus_count].children?Arrs[a+plus_count].children.length-n:"0")+"명에게 전파</p>",r+="<p>격리 병원 : "+e.hospital+"</p>",r+="<p>확진 날짜 : "+e.confirmDate+"</p>",r+=2==e.status?"<p>격리 해제 : "+e.dischargeDate+"</p>":"",document.getElementById("info_").innerHTML=r,showDetail("alertMsg",324,204)}}Arrs.push(JSON.parse('{"text": {"cn": "COVID-19","name":""},"HTMLclass":"title"}')),Arrs.push(JSON.parse('{"text": {"country":"중국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"일본","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"태국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"싱가포르","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"대한민국","name":""},"HTMLclass":"country","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"대구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[5],Arrs.push(JSON.parse('{"text": {"country":"중구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"동구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"서구","name":""},"HTMLclass":"country country2"}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"남구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"북구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"수성구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"달서구","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"달성군","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[6],Arrs.push(JSON.parse('{"text": {"country":"확인중","name":""},"HTMLclass":"country country2","collapsed":true}')),Arrs[Arrs.length-1].parent=Arrs[5],function(){var a=new XMLHttpRequest;a.open("GET","./data.json?"+parseInt((new Date).getTime()/6e4),!0),a.onreadystatechange=function(){if(4==a.readyState)if(200==a.status){Jobj=JSON.parse(a.responseText),document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;var e=0,t=0,r=0,s=0,n=0,o=[],u=JSON.parse('{"kr":0,"cn":0,"default":0}'),c=JSON.parse('{"0":0,"1":0,"2":0}'),l=100,p=0,d=1e4,i=0,h=0,b=0,g=0,A=[],m=Jobj.info.update.split(" ")[0],J=formatDate(addDays(Jobj.info.update.split(" ")[0],-1));CheckDate();for(var y=0;y<Jobj.data.length;y++){if(document.getElementById("progress").style.width=y/(Jobj.data.length-1)*50+"%",document.getElementById("progress").innerText=document.getElementById("progress").style.width,Arrs.push(JSON.parse("{}")),Arrs[Arrs.length-1].text=JSON.parse('{"name": "#'+Jobj.data[y].num+'"}'),Arrs[Arrs.length-1].image="./"+Jobj.data[y].sex+".png",null==o[Jobj.data[y].hospital]&&(o.push({name:Jobj.data[y].hospital,cou:0,cou2:0,cou0:0}),o[Jobj.data[y].hospital]=o.length-1),1==Jobj.data[y].status)o[o[Jobj.data[y].hospital]].cou++;else if(2==Jobj.data[y].status){o[o[Jobj.data[y].hospital]].cou2++;var f=(new Date(Jobj.data[y].dischargeDate).getTime()-new Date(Jobj.data[y].confirmDate).getTime())/864e5;A.push(f),d=d>f?f:d,i=i<f?f:i,b++,h+=f}else 0==Jobj.data[y].status&&(o[o[Jobj.data[y].hospital]].cou0++,"0"==Jobj.data[y].sex&&(Arrs[Arrs.length-1].pseudo=!0));switch(Jobj.data[y].wuhan&&(s++,"우한 교민"==Jobj.data[y].from&&n++),Arrs[Arrs.length-1].HTMLclass="status_"+Jobj.data[y].status,Jobj.data[y].confirmDate){case m:case J:Arrs[Arrs.length-1].HTMLclass+=" today_new"}switch(c[Jobj.data[y].status]++,isNaN(Jobj.data[y].age)?g++:e+=parseInt(Jobj.data[y].age),l=l>Jobj.data[y].age?Jobj.data[y].age:l,p=p<Jobj.data[y].age?Jobj.data[y].age:p,Jobj.data[y].sex){case"m":t++;break;case"w":r++;break;default:0}switch(Jobj.data[y].country){case"kr":u.kr++;break;case"cn":u.cn++;break;default:u.default++}}for(y=1;y<=Jobj.data.length;y++)switch(document.getElementById("progress").style.width=50+y/Jobj.data.length*50+"%",document.getElementById("progress").innerText=document.getElementById("progress").style.width,Jobj.data[y-1].parent){case 0:switch(Jobj.data[y-1].from){case"일본 방문":Arrs[y+plus_count].parent=Arrs[2];break;case"태국 방문":Arrs[y+plus_count].parent=Arrs[3];break;case"싱가포르 방문":Arrs[y+plus_count].parent=Arrs[4];break;case"국내 감염":case"국내 감염?":case"확인중":switch(Jobj.data[y-1].from2){case"대구":switch(Jobj.data[y-1].from3){case"중구":Arrs[y+plus_count].parent=Arrs[7];break;case"동구":Arrs[y+plus_count].parent=Arrs[8];break;case"서구":Arrs[y+plus_count].parent=Arrs[9];break;case"남구":Arrs[y+plus_count].parent=Arrs[10];break;case"북구":Arrs[y+plus_count].parent=Arrs[11];break;case"수성구":Arrs[y+plus_count].parent=Arrs[12];break;case"달서구":Arrs[y+plus_count].parent=Arrs[13];break;case"달성군":Arrs[y+plus_count].parent=Arrs[14];break;default:Arrs[y+plus_count].parent=Arrs[6]}break;default:Arrs[y+plus_count].parent=Arrs[15]}break;default:Arrs[y+plus_count].parent=Arrs[1]}break;default:Arrs[y+plus_count].parent=Arrs[Jobj.data[y-1].parent+plus_count]}Arrs[26+plus_count].parent=Arrs[27+plus_count],Arrs[31+plus_count].childrenDropLevel=1,Arrs[15+plus_count].connectors=JSON.parse('{"style":{"stroke": "#b71c1c","arrow-end": "block-wide-long"}}'),Arrs.push(JSON.parse('{"container": "#nCov","siblingSeparation":20,"levelSeparation":25,"subTeeSeparation":20,"nodeAlign": "TOP","connectors": {"type": "step","style": {"stroke-width": 2,"stroke": "#666"}},"node": {"HTMLclass": "node1","collapsable": true}}')),new Treant(Arrs),setTimeout(function(){document.getElementById("graph2").style.display="none"},200);var j=document.getElementsByClassName("node");for(y=0;y<j.length;y++)j[y].addEventListener("click",MsgAlert);var D="";o.sort(function(a,e){return parseInt(a.cou)>parseInt(e.cou)?-1:parseInt(a.cou)<parseInt(e.cou)?1:0}),D+="<p>총 확진자 수 : <b>"+Jobj.data.length+"명</b> (우한 방문자 "+s+"명)</p>",D+="<p>격리중 : <b>"+c[1]+"명</b>, 완치 : <b>"+c[2]+"명</b>, 사망자 : "+c[0]+"명</p>",D+="<p>유증상자 : 조사 중 <b>"+Jobj.info.Symptom_quarantine+"명</b>, 격리해제(음성) "+Jobj.info.Symptom_release+"명",D+="<p>평균 연령 : <b>"+parseFloat((e/(Jobj.data.length-g)).toFixed(1))+"세</b> ("+l+"~"+p+"세)"+(g>0?" , "+g+"명 나이확인 안됨.":"")+"</p>",document.getElementById("stats_ex").innerHTML="("+g+"명 확인 안됨)",D+="<p>성비 : 남성 "+t+"명 : 여성 "+r+"명 "+(t>r?"("+parseFloat((t/r).toFixed(1))+" : 1)":"(1 : "+parseFloat((r/t).toFixed(1))+")")+"</p>",D+="<p>국적 : 한국인 "+u.kr+"명, 중국인 "+u.cn+"명</p>",D+="<p>우한 교민 : <b>"+n+"명</b> 확진</p>",D+="<p>회복 시간 : <b>평균 "+parseFloat(parseFloat(h/b).toFixed(1))+"일</b> ("+d+"~"+i+"일)</p>",D+="<br><div class='stats_inner'><h4>격리 병원 통계 (총 "+c[1]+"명)</h4><ul class='sitelist'>";var k="";for(y=0;y<o.length;y++)"확인중"==o[y].name?k="<li>"+o[y].name+" : "+o[y].cou+"명</li>":0!=o[y].cou&&(D+="<li>"+o[y].name+" : "+o[y].cou+"명</li>");D+=k+"</ul></div>",D+="<div class='stats_inner'><h4>완치 병원 통계 (총 "+c[2]+"명)</h4><ul class='sitelist'>",o.sort(function(a,e){return parseInt(a.cou2)>parseInt(e.cou2)?-1:parseInt(a.cou2)<parseInt(e.cou2)?1:0});for(y=0;y<o.length;y++)0!=o[y].cou2&&(D+="<li>"+o[y].name+" : "+o[y].cou2+"명</li>");D+="</ul></div>",document.getElementById("stats").innerHTML=D,setTimeout(drawGR,0)}else alert("데이터 로딩에 실패하였습니다.")},a.send()}(),window.addEventListener("resize",function(){if(before_X!=window.innerWidth){before_X=window.innerWidth,Treant(Arrs),Arrs[31+plus_count].childrenDropLevel=1;for(var a=document.getElementsByClassName("node"),e=0;e<a.length;e++)a[e].addEventListener("click",MsgAlert)}});var gr_day,gr_age,confirmData=[],dischargeData=[],deathData=[];function drawGR(){gr_day&&gr_day.destroy(),gr_age&&gr_age.destroy(),gr_day=new Chart(document.getElementById("Day_stats").getContext("2d"),{type:"line",data:{labels:Dates,datasets:[{label:"총 확진자 수",data:confirmData,backgroundColor:"rgba(255, 159, 64, 0)",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,lineTension:0},{label:"완치자 수",data:dischargeData,borderColor:"rgba(75, 192, 192, 0.8)",backgroundColor:"rgba(75, 192, 192, 0)",borderWidth:2,lineTension:0},{label:"사망자 수",data:deathData,borderColor:"rgba(100, 100, 100, 0.8)",backgroundColor:"rgba(100, 100, 100, 0)",borderWidth:2,lineTension:0}]}});var a=CheckAge();gr_age=new Chart(document.getElementById("Age_stats").getContext("2d"),{type:"bar",data:{labels:["0-9세","10-19세","20-29세","30-39세","40-49세","50-59세","60-69세","70-79세","80세 이상"],datasets:[{label:"총 확진자 수",data:a[0],backgroundColor:"rgba(255, 99, 132,0.8)",borderColor:"rgba(255, 99, 132, 0)",borderWidth:2,lineTension:0},{label:"완치자 수",data:a[1],borderColor:"rgba(75, 192, 192, 0)",backgroundColor:"rgba(75, 192, 192, 0.8)",borderWidth:2,lineTension:0}]}})}function CheckDate(){Jobj.data.length;var a=new Date(Jobj.data[0].confirmDate).getTime(),e=new Date(Jobj.info.update.split(" ")[0]).getTime(),t=[],r=0,s=0,n=0;Dates=[];for(var o=[],u=0;;){var c=addDays(a,u);if(u++,!(c>=a&&c<=e))break;var l=formatDate(c);Dates.push(l),null==t[l]&&(t.push({name:l,cou1:0,cou2:0,cou0:0}),t[l]=t.length-1)}for(u=0;u<Jobj.data.length;u++)o[o.length-1]!=Jobj.data[u].confirmDate&&o.push(Jobj.data[u].confirmDate),t[t[Jobj.data[u].confirmDate]].cou1++,2==Jobj.data[u].status?t[t[Jobj.data[u].dischargeDate]].cou2++:0==Jobj.data[u].status&&t[t[Jobj.data[u].confirmDate]].cou0++;n+=t[t[o[0]]].cou2,r+=t[t[o[0]]].cou1,s+=t[t[o[0]]].cou0,confirmData.push(t[t[o[0]]].cou1),dischargeData.push(n),deathData.push(s);for(u=1;u<Dates.length;u++)n+=t[t[Dates[u]]].cou2,r+=t[t[Dates[u]]].cou1,s+=t[t[Dates[u]]].cou0,confirmData.push(r),dischargeData.push(n),deathData.push(s)}function CheckAge(){for(var a=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),e=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),t=0;t<Jobj.data.length;t++)if(!isNaN(Jobj.data[t].age))switch(parseInt(Jobj.data[t].age/10)){case 0:a.a0++,2==Jobj.data[t].status&&e.a0++;break;case 1:a.a1++,2==Jobj.data[t].status&&e.a1++;break;case 2:a.a2++,2==Jobj.data[t].status&&e.a2++;break;case 3:a.a3++,2==Jobj.data[t].status&&e.a3++;break;case 4:a.a4++,2==Jobj.data[t].status&&e.a4++;break;case 5:a.a5++,2==Jobj.data[t].status&&e.a5++;break;case 6:a.a6++,2==Jobj.data[t].status&&e.a6++;break;case 7:a.a7++,2==Jobj.data[t].status&&e.a7++;break;default:a.a8++,2==Jobj.data[t].status&&e.a8++}var r=[],s=[],n=[];return r.push(a.a0),r.push(a.a1),r.push(a.a2),r.push(a.a3),r.push(a.a4),r.push(a.a5),r.push(a.a6),r.push(a.a7),r.push(a.a8),n.push(r),s.push(e.a0),s.push(e.a1),s.push(e.a2),s.push(e.a3),s.push(e.a4),s.push(e.a5),s.push(e.a6),s.push(e.a7),s.push(e.a8),n.push(s),n}function formatDate(a){var e=new Date(a),t=""+(e.getMonth()+1),r=""+e.getDate(),s=e.getFullYear();return t.length<2&&(t="0"+t),r.length<2&&(r="0"+r),[s,t,r].join("-")}function addDays(a,e){var t=new Date(a);return t.setDate(t.getDate()+e),t}function listdata(a,e){for(var t=[],r=0;r<Dates.length;r++)e(r)&&t.push(a(r));return t}function listarr(a,e){for(var t=[],r=a.length,s=0;s<r;s++)e(s)&&t.push(a[s]);return t}

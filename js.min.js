var Jobj,Arrs=[],Dates=[],before_X=window.innerWidth,plus_count=4;function showDetail(e,t,a){document.getElementById(e).style.display="",document.getElementById(e).style.left=(window.innerWidth-t)/2+"px",document.getElementById(e).style.top=(window.innerHeight-a)/2+"px"}function MsgAlert(){var e=this.getElementsByClassName("node-name")[0].innerText.split(" ")[0].split("#")[1];if(""!=e&&null!=e){e=parseInt(e);var t=Jobj.data[e-1],a="";switch(t.status){case 0:a="(사망)";break;case 2:a="(완치)"}document.getElementById("title_").innerText=t.num+"번 확진자 "+a;var s="",n="";switch(t.country){case"cn":n="중국";break;case"kr":n="한국";break;case"mn":n="몽골";break;default:n=t.country}var r=0;switch(e){case 27:r=1}s+="<h3 class='d'>"+t.from+" <span>"+t.age+(isNaN(t.age)?"?세":"세")+" "+n+" "+("w"==t.sex?"여성":"m"==t.sex?"남성":"")+"</span></h3>",s+="<p>접촉자 "+(void 0!==t.contact?t.contact+"명":"확인중")+", "+(0==r?"":"<i title='표의 표시와는 달리 확진자와 같은 장소 여행자는 포함 안 함'> * </i>")+(void 0!==Arrs[e+plus_count].children?Arrs[e+plus_count].children.length-r:"0")+"명에게 전파</p>",s+="<p>격리 병원 : "+t.hospital+"</p>",s+="<p>확진 날짜 : "+t.confirmDate+"</p>",s+=2==t.status?"<p>격리 해제 : "+t.dischargeDate+"</p>":"",document.getElementById("info_").innerHTML=s,showDetail("alertMsg",324,204)}}Arrs.push(JSON.parse('{"text": {"cn": "COVID-19","name":""},"HTMLclass":"title"}')),Arrs.push(JSON.parse('{"text": {"country":"중국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"일본","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"태국","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],Arrs.push(JSON.parse('{"text": {"country":"싱가포르","name":""},"HTMLclass":"country"}')),Arrs[Arrs.length-1].parent=Arrs[0],function(){var e=new XMLHttpRequest;e.open("GET","./data.json?"+parseInt((new Date).getTime()/6e4),!0),e.onreadystatechange=function(){if(4==e.readyState)if(200==e.status){Jobj=JSON.parse(e.responseText),document.getElementById("update").innerText="최근 업데이트 : "+Jobj.info.update;var t=0,a=0,s=0,n=0,r=0,o=[],d=JSON.parse('{"kr":0,"cn":0,"mn":0,"default":0}'),l=JSON.parse('{"0":0,"1":0,"2":0}'),u=100,c=0,i=1e4,p=0,b=0,m=0,g=0,h=[],y=Jobj.info.update.split(" ")[0],J=formatDate(addDays(Jobj.info.update.split(" ")[0],-1));CheckDate();for(var f=[],j=0;j<Jobj.data.length;j++){if(document.getElementById("progress").style.width=j/(Jobj.data.length-1)*50+"%",document.getElementById("progress").innerText=document.getElementById("progress").style.width,Arrs.push(JSON.parse("{}")),Arrs[Arrs.length-1].text=JSON.parse('{"name": "#'+Jobj.data[j].num+'"}'),Arrs[Arrs.length-1].image="./"+Jobj.data[j].sex+".png",null==o[Jobj.data[j].hospital]&&(o.push({name:Jobj.data[j].hospital,cou:0,cou2:0,cou0:0}),o[Jobj.data[j].hospital]=o.length-1),1==Jobj.data[j].status)o[o[Jobj.data[j].hospital]].cou++;else if(2==Jobj.data[j].status){o[o[Jobj.data[j].hospital]].cou2++;var A=(new Date(Jobj.data[j].dischargeDate).getTime()-new Date(Jobj.data[j].confirmDate).getTime())/864e5;h.push(A),i=i>A?A:i,p=p<A?A:p,m++,b+=A}else 0==Jobj.data[j].status&&(o[o[Jobj.data[j].hospital]].cou0++,"0"==Jobj.data[j].sex&&(Arrs[Arrs.length-1].pseudo=!0));switch(Jobj.data[j].wuhan&&(n++,"우한 교민"==Jobj.data[j].from&&r++),Arrs[Arrs.length-1].HTMLclass="status_"+Jobj.data[j].status,Jobj.data[j].confirmDate){case y:case J:Arrs[Arrs.length-1].HTMLclass+=" today_new"}switch(l[Jobj.data[j].status]++,isNaN(Jobj.data[j].age)?g++:t+=parseInt(Jobj.data[j].age),u=u>Jobj.data[j].age?Jobj.data[j].age:u,c=c<Jobj.data[j].age?Jobj.data[j].age:c,Jobj.data[j].sex){case"m":a++;break;case"w":s++;break;default:0}switch(Jobj.data[j].country){case"kr":d.kr++;break;case"cn":d.cn++;break;case"mn":d.mn++;break;default:d.default++}}for(j=1;j<=Jobj.data.length;j++)switch(document.getElementById("progress").style.width=50+j/Jobj.data.length*50+"%",document.getElementById("progress").innerText=document.getElementById("progress").style.width,Jobj.data[j-1].parent){case 0:switch(Jobj.data[j-1].from){case"일본 방문":Arrs[j+plus_count].parent=Arrs[2];break;case"태국 방문":Arrs[j+plus_count].parent=Arrs[3];break;case"싱가포르 방문":Arrs[j+plus_count].parent=Arrs[4];break;case"국내 감염":case"국내 감염?":case"확인중":break;default:Arrs[j+plus_count].parent=Arrs[1]}break;default:switch(Jobj.data[Jobj.data[j-1].parent-1].from){case"국내 감염":case"국내 감염?":case"확인중":f.push(Jobj.data[Jobj.data[j-1].parent-1].num);break;default:-1==f.indexOf(Jobj.data[Jobj.data[j-1].parent-1].parent)&&(Arrs[j+plus_count].parent=Arrs[Jobj.data[j-1].parent+plus_count])}}Arrs[26+plus_count].parent=Arrs[27+plus_count],Arrs[31+plus_count].childrenDropLevel=1,Arrs[15+plus_count].connectors=JSON.parse('{"style":{"stroke": "#b71c1c","arrow-end": "block-wide-long"}}'),Arrs.push(JSON.parse('{"container": "#nCov","siblingSeparation":20,"levelSeparation":25,"subTeeSeparation":20,"nodeAlign": "TOP","connectors": {"type": "step","style": {"stroke-width": 2,"stroke": "#666"}},"node": {"HTMLclass": "node1","collapsable": true}}')),setTimeout(function(){new Treant(Arrs),document.getElementById("graph2").style.display="none";for(var e=document.getElementsByClassName("node"),t=0;t<e.length;t++)e[t].addEventListener("click",MsgAlert)},200);var D="";o.sort(function(e,t){return parseInt(e.cou)>parseInt(t.cou)?-1:parseInt(e.cou)<parseInt(t.cou)?1:0}),D+="<p>총 확진자 수 : <b>"+Jobj.data.length+"명</b> (우한 방문자 "+n+"명)</p>",D+="<p>격리중 : <b>"+l[1]+"명</b>, 완치 : <b>"+l[2]+"명</b>, 사망자 : "+l[0]+"명</p>",D+="<p>유증상자 : 조사 중 <b>"+Jobj.info.Symptom_quarantine+"명</b>, 격리해제(음성) "+Jobj.info.Symptom_release+"명",D+="<p>평균 연령 : <b>"+parseFloat((t/(Jobj.data.length-g)).toFixed(1))+"세</b> ("+u+"~"+c+"세)"+(g>0?" , "+g+"명 나이확인 안됨.":"")+"</p>",document.getElementById("stats_ex").innerHTML="("+g+"명 확인 안됨)",D+="<p>성비 : 남성 "+a+"명 : 여성 "+s+"명 "+(a>s?"("+parseFloat((a/s).toFixed(1))+" : 1)":"(1 : "+parseFloat((s/a).toFixed(1))+")")+"</p>",D+="<p>국적 : 한국인 "+d.kr+"명, 중국인 "+d.cn+"명</p>",D+="<p>우한 교민 : <b>"+r+"명</b> 확진</p>",D+="<p>회복 시간 : <b>평균 "+parseFloat(parseFloat(b/m).toFixed(1))+"일</b> ("+i+"~"+p+"일)</p>",D+="<br><div class='stats_inner'><h4>격리 병원 통계 (총 "+l[1]+"명)</h4><ul class='sitelist'>";var v="";for(j=0;j<o.length;j++)"확인중"==o[j].name?v="<li>"+o[j].name+" : "+o[j].cou+"명</li>":0!=o[j].cou&&(D+="<li>"+o[j].name+" : "+o[j].cou+"명</li>");D+=v+"</ul></div>",D+="<div class='stats_inner'><h4>완치 병원 통계 (총 "+l[2]+"명)</h4><ul class='sitelist'>",o.sort(function(e,t){return parseInt(e.cou2)>parseInt(t.cou2)?-1:parseInt(e.cou2)<parseInt(t.cou2)?1:0});for(j=0;j<o.length;j++)0!=o[j].cou2&&(D+="<li>"+o[j].name+" : "+o[j].cou2+"명</li>");D+="</ul></div>",document.getElementById("stats").innerHTML=D,setTimeout(drawGR,0)}else alert("데이터 로딩에 실패하였습니다.")},e.send()}(),window.addEventListener("resize",function(){if(before_X!=window.innerWidth){before_X=window.innerWidth,Treant(Arrs),Arrs[31+plus_count].childrenDropLevel=1;for(var e=document.getElementsByClassName("node"),t=0;t<e.length;t++)e[t].addEventListener("click",MsgAlert)}});var gr_day,gr_age,confirmData=[],dischargeData=[],deathData=[];function drawGR(){gr_day&&gr_day.destroy(),gr_age&&gr_age.destroy(),gr_day=new Chart(document.getElementById("Day_stats").getContext("2d"),{type:"line",data:{labels:Dates,datasets:[{label:"총 확진자 수",data:confirmData,backgroundColor:"rgba(255, 159, 64, 0)",borderColor:"rgba(255, 99, 132, 0.8)",borderWidth:2,lineTension:0},{label:"완치자 수",data:dischargeData,borderColor:"rgba(75, 192, 192, 0.8)",backgroundColor:"rgba(75, 192, 192, 0)",borderWidth:2,lineTension:0},{label:"사망자 수",data:deathData,borderColor:"rgba(100, 100, 100, 0.8)",backgroundColor:"rgba(100, 100, 100, 0)",borderWidth:2,lineTension:0}]}});var e=CheckAge();gr_age=new Chart(document.getElementById("Age_stats").getContext("2d"),{type:"bar",data:{labels:["0-9세","10-19세","20-29세","30-39세","40-49세","50-59세","60-69세","70-79세","80세 이상"],datasets:[{label:"총 확진자 수",data:e[0],backgroundColor:"rgba(255, 99, 132,0.8)",borderColor:"rgba(255, 99, 132, 0)",borderWidth:2,lineTension:0},{label:"완치자 수",data:e[1],borderColor:"rgba(75, 192, 192, 0)",backgroundColor:"rgba(75, 192, 192, 0.8)",borderWidth:2,lineTension:0}]}})}function CheckDate(){Jobj.data.length;var e=new Date(Jobj.data[0].confirmDate).getTime(),t=new Date(Jobj.info.update.split(" ")[0]).getTime(),a=[],s=0,n=0,r=0;Dates=[];for(var o=[],d=0;;){var l=addDays(e,d);if(d++,!(l>=e&&l<=t))break;var u=formatDate(l);Dates.push(u),null==a[u]&&(a.push({name:u,cou1:0,cou2:0,cou0:0}),a[u]=a.length-1)}for(d=0;d<Jobj.data.length;d++)o[o.length-1]!=Jobj.data[d].confirmDate&&o.push(Jobj.data[d].confirmDate),a[a[Jobj.data[d].confirmDate]].cou1++,2==Jobj.data[d].status?a[a[Jobj.data[d].dischargeDate]].cou2++:0==Jobj.data[d].status&&a[a[Jobj.data[d].confirmDate]].cou0++;r+=a[a[o[0]]].cou2,s+=a[a[o[0]]].cou1,n+=a[a[o[0]]].cou0,confirmData.push(a[a[o[0]]].cou1),dischargeData.push(r),deathData.push(n);for(d=1;d<Dates.length;d++)r+=a[a[Dates[d]]].cou2,s+=a[a[Dates[d]]].cou1,n+=a[a[Dates[d]]].cou0,confirmData.push(s),dischargeData.push(r),deathData.push(n)}function CheckAge(){for(var e=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),t=JSON.parse('{"a0":0,"a1":0,"a2":0,"a3":0,"a4":0,"a5":0,"a6":0,"a7":0,"a8":0}'),a=0;a<Jobj.data.length;a++)if(!isNaN(Jobj.data[a].age))switch(parseInt(Jobj.data[a].age/10)){case 0:e.a0++,2==Jobj.data[a].status&&t.a0++;break;case 1:e.a1++,2==Jobj.data[a].status&&t.a1++;break;case 2:e.a2++,2==Jobj.data[a].status&&t.a2++;break;case 3:e.a3++,2==Jobj.data[a].status&&t.a3++;break;case 4:e.a4++,2==Jobj.data[a].status&&t.a4++;break;case 5:e.a5++,2==Jobj.data[a].status&&t.a5++;break;case 6:e.a6++,2==Jobj.data[a].status&&t.a6++;break;case 7:e.a7++,2==Jobj.data[a].status&&t.a7++;break;default:e.a8++,2==Jobj.data[a].status&&t.a8++}var s=[],n=[],r=[];return s.push(e.a0),s.push(e.a1),s.push(e.a2),s.push(e.a3),s.push(e.a4),s.push(e.a5),s.push(e.a6),s.push(e.a7),s.push(e.a8),r.push(s),n.push(t.a0),n.push(t.a1),n.push(t.a2),n.push(t.a3),n.push(t.a4),n.push(t.a5),n.push(t.a6),n.push(t.a7),n.push(t.a8),r.push(n),r}function formatDate(e){var t=new Date(e),a=""+(t.getMonth()+1),s=""+t.getDate(),n=t.getFullYear();return a.length<2&&(a="0"+a),s.length<2&&(s="0"+s),[n,a,s].join("-")}function addDays(e,t){var a=new Date(e);return a.setDate(a.getDate()+t),a}function listdata(e,t){for(var a=[],s=0;s<Dates.length;s++)t(s)&&a.push(e(s));return a}function listarr(e,t){for(var a=[],s=e.length,n=0;n<s;n++)t(n)&&a.push(e[n]);return a}function Dr(e){if(0==e){document.getElementsByClassName("btn_menu")[0].id="selected_btn_menu",document.getElementsByClassName("btn_menu")[1].id="",document.getElementsByClassName("btn_menu")[2].id="",document.getElementById("nCov0").style.display="",document.getElementById("nCov").style.display="",document.getElementById("nCov2").style.display="none",document.getElementById("nCov3").style.display="",Treant(Arrs),Arrs[31+plus_count].childrenDropLevel=1;for(var t=document.getElementsByClassName("node"),a=0;a<t.length;a++)t[a].addEventListener("click",MsgAlert)}else 1==e?(document.getElementsByClassName("btn_menu")[0].id="",document.getElementsByClassName("btn_menu")[1].id="",document.getElementsByClassName("btn_menu")[2].id="selected_btn_menu",document.getElementById("nCov0").style.display="none",document.getElementById("nCov").style.display="none",document.getElementById("nCov2").style.display="",document.getElementById("nCov3").style.display="none"):(document.getElementsByClassName("btn_menu")[0].id="",document.getElementsByClassName("btn_menu")[1].id="selected_btn_menu",document.getElementsByClassName("btn_menu")[2].id="",document.getElementById("nCov0").style.display="",document.getElementById("nCov").style.display="",document.getElementById("nCov2").style.display="none",document.getElementById("nCov3").style.display="",Dr(0),alert("로딩이 오래걸릴수있습니다.\n\n아직 페이지 생성중!\n한국확진자는 관계도가 그리기어려워 구상중에 있습니다."))}